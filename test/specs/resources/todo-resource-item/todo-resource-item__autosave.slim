== html_test 'resources/todo-resource.html'

  / Mocks/Helpers
  / -------------
  script src='../../../helpers/MockNote.js'

  polymer-element name="t-test"
    template
      todo-resource-item item_id="{{ item_id }}" item="{{ todo }}"
      
    coffee:
      # Setup
      # -----
      localStorage.removeItem 'ioi-store'
      note1 = @MockNote()
      note2 = @MockNote()
      note3 = @MockNote()
      localStorage.setItem 'ioi-store', JSON.stringify AllMockNotes = @AllMockNotes
      getStore = -> JSON.parse localStorage.getItem 'ioi-store'

      Polymer 't-test',
        item_id: note2.id

        # Test
        # ----
        todoChanged: ->
          return if not @todo or @testStarted
          @testStarted = true

          AllMockNotes[note2.id].text = @todo.text = 'foo'
          @async ->
            expect(getStore()).to.deep.equal AllMockNotes

            AllMockNotes[note2.id].notes = @todo.notes = 'foo notes'
            @async ->
              expect(getStore()).to.deep.equal AllMockNotes

              AllMockNotes[note2.id].done = @todo.done = not @todo.done
              @async ->
                expect(getStore()).to.deep.equal AllMockNotes

                done()