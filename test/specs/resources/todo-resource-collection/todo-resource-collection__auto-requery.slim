== html_test 'resources/todo-resource.html'

  / Mocks/Helpers
  / -------------
  script src='../../../helpers/MockNote.js'

  polymer-element name="t-test"
    template
      todo-resource-collection query="{{ query }}" items="{{ todos }}"
      
    coffee:
      # Setup
      # -----
      localStorage.removeItem 'ioi-store'
      note1 = @MockNote text: 'one', notes: 'a', done: true
      note2 = @MockNote text: 'one two', notes: 'a', done: false
      note3 = @MockNote text: 'one two three', notes: 'b', done: false
      localStorage.setItem 'ioi-store', JSON.stringify @AllMockNotes

      Polymer 't-test',
        query:
          text: 'MATCHNOTHIN'

        todos: undefined

        # Test
        # ----
        todosChanged: ->
          return if not @todos or @testStarted
          @testStarted = true

          @query.text = 'one'
          @async ->
            expect(@todos).to.deep.equal [
              note3
              note2
              note1
            ]

            @query.notes = 'a'
            @async ->
              expect(@todos).to.deep.equal [
                note2
                note1
              ]

              @query.done = false
              @async ->
                expect(@todos).to.deep.equal [
                  note2
                ]

                done()
