link rel='import' href='../models/m-user.html'
link rel='import' href='../../vendor/polymer-all/polymer-elements/polymer-ajax/polymer-xhr.html'
link rel='import' href='../../vendor/polymer-all/polymer-elements/polymer-ajax/polymer-ajax.html'

polymer-element name="r-todos-es-backend"
  template
    m-user#user
    polymer-xhr#xhr
    polymer-ajax [ auto=''
                   url="http://gdata.youtube.com/feeds/api/videos/"
                   params='{"alt":"json", "q":"chrome"}'
                   handleAs="json" ]
    

  coffee:
    Polymer 'r-todos-es-backend',
      serverURL: 'http://127.0.0.1:9200'

      get: ()->

      update: (todo)->
        if @$.user.id and todo?.id
          @$.xhr.request
            method: 'PUT'
            url: "#{@testServerURL}/#{@$.user.id}/todos/_bulk"
            data: docDatas.join('\n')+'\n'
            callback: ->

      create: (todos)->
        if @$.user.id
          todos = [todos] unless Array.isArray todos
          docDatas =
            for doc in todos
              """
              #{JSON.stringify {create:{}}}
              #{JSON.stringify doc}
              """
          @$.xhr.request
            method: 'POST'
            url: "#{@testServerURL}/#{@$.user.id}/todos/_bulk"
            data: docDatas.join('\n')+'\n'
            callback: ->

      delete: (todo)->
        if @$.user.id
          @$.xhr.request
            method: 'DELETE'
            url: "#{@testServerURL}/#{@$.user.id}/todos/#{todo.id}"
            callback: ->