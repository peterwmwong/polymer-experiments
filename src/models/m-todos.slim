link rel='import' href='../../vendor/polymer-all/polymer-elements/polymer-localstorage/polymer-localstorage.html'

polymer-element name='m-todos' attributes='todos'
  template
    polymer-localstorage [ id="localstorage"
                           name="ioi-store"
                           value="{{ todos }}"
                           on-polymer-localstorage-load="onInitialStorageLoad" ]

  coffee:
    Polymer 'm-todos',

      todos: []

      addTodo: ({text,done})->
        @todos.unshift newTodo = {text,done}
        @$.localstorage.save()
        newTodo

      removeTodo: (todo)->
        if -1 < (id = @todos.indexOf todo)
          @todos.splice id, 1
          @$.localstorage.save()

      onInitialStorageLoad: ->
        unless @todos
          @todos = []
          @$.localstorage.save()
        @asyncFire 'm-todos-load'
